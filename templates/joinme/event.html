{% extends "joinme/base.html" %}
{% load static %}

{% block page %}
{% if event.active or event.author.id == user.userprofile.id %}
<div class="page-header">
	<h1 class="text-center">{{ event.title }} 
		<small><i class="{{ event.category.icon }}"></i> {{ event.category.title }}</small>
	</h1>
</div>
<div class="row">
	<div class="col-md-6 col-md-offset-3">
		<div class="panel panel-{{ event.category.color|default:"primary" }} event-detail" id="event-{{ event.id }}">
			<div class="panel-body">
				{% if event.author.id == user.userprofile.id %}
					<div class="btn-group-vertical pull-right" role="group">
						<a href="{{ event.get_edit_url }}" class="btn btn-default">
							<i class="fa fa-pencil"></i>
						</a>
						<a href="{{ event.get_delete_url }}" class="btn btn-default">
							<i class="fa fa-trash-o"></i>
						</a>
					</div>
				{% endif %}
				<h3>Description</h3>
				<div>{{ event.description }}</div>
				<h3>Members</h3>
				<div>
					<ul class="list-group">
						<li class="list-group-item">
							<h4 class="list-group-item-heading">
								<i class="mdi-editor-insert-emoticon"></i> {{ event.author }}
							</h4>
						</li>
						{% for user in event.users.all %}
							<li class="list-group-item">
								<h4 class="list-group-item-heading">
									<i class="mdi-social-person"></i> {{ user }}
								</h4>
							</li>
						{% endfor %}
					</ul>
				</div>
				<div class="text-center">
				{% if event.author.id != user.userprofile.id %}
					{% if user.userprofile in event.users.all %}
						<a href="{{ event.get_leave_url }}" class="btn btn-danger">Leave Event</a>
					{% else %}
						<a href="{{ event.get_join_url }}" class="btn btn-success">Join Event</a>
					{% endif %}
				{% endif %}
				</div>
			</div>
			<div class="panel-footer">
				{% if not event.active %}
				<div class="pull-right text-danger"><i class="fa fa-exclamation-circle"></i> Inactive</div>
				{% endif %}
				<div>{{ event.datetime }}</div>
			</div>
		</div>

		{# Comments #}
		<div class="comment-head text-center">
			<h2 data-toggle="collapse"  data-target="#comments">Comments <span class="caret"></span></h2>
		</div>
		<div id="comments" class="collapse">

			<div class="list-group">
				{% for comment in event.comments.all %}
				<div id="comment-{{ comment.id }}" class="list-group-item comment">
					<div class="row-picture comment-user-photo">
						{% with comment.user.get_user_photo as photo %}
							{% if photo %}
							<img class="circle" src="{{ photo }}" alt="icon">
							{% else %}
							<i class="mdi-social-person"></i>
							{% endif %}
						{% endwith %}
					</div>
					<div class="row-content">
						<div class="least-content comment-date">{{ comment.pub_date|date:"d E Y H:i" }}</div>
						<h4 class="list-group-item-heading comment-username">{{ comment.user.get_username }}</h4>
						<p class="list-group-item-text comment-message">{{ comment.message }}</p>
					</div>
				</div>
				<div class="list-group-separator"></div>
				{% endfor %}
			</div>

			{# Form to add Comment #}
			<div class="">
				<form class="form-horizontal" id="commentForm" action="" method="post">
					{% csrf_token %}
					<fieldset>
						<legend>Add comment</legend>
						<div class="form-group">
							<label for="commentMessage" class="control-label col-lg-2">Message</label>
							<div class="col-lg-10">
								<textarea name="message" id="commentMessage" rows="4" class="form-control" data-hint="Don't use any HTML tags"></textarea>
							</div>
						</div>
						<div class="form-group">
							<div class="col-lg-10 col-lg-offset-2">
								<button data-type="submit" class="btn btn-primary">Submit</button>
							</div>
						</div>
					</fieldset>
				</form>
			</div>
		</div>
	</div>
</div>
{% else %}
<div class="page-header">
	<h1 class="text-center"><i class="fa fa-exclamation-circle"></i> Event is inactive</h1>
</div>
<h2 class="text-center">Author has not yet published this Event.</h2>
{% endif %}

{% endblock page %}
